{
  "entities": {
    "Video": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Video",
      "type": "object",
      "description": "Represents a video saved by the user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the video.",
          "format": "uuid"
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User who saved the video. (Relationship: User 1:N Video)"
        },
        "title": {
          "type": "string",
          "description": "Title of the video."
        },
        "url": {
          "type": "string",
          "description": "URL of the video.",
          "format": "uri"
        },
        "platform": {
          "type": "string",
          "description": "Platform the video is from (e.g., Instagram, YouTube, TikTok)."
        },
        "duration": {
          "type": "number",
          "description": "Duration of the video in seconds."
        },
        "thumbnailUrl": {
          "type": "string",
          "description": "URL of the video's thumbnail image.",
          "format": "uri"
        },
        "categoryId": {
          "type": "string",
          "description": "Reference to the Category this video belongs to. (Relationship: Category 1:N Video)"
        },
        "note": {
          "type": "string",
          "description": "User's note about the video."
        },
        "savedAt": {
          "type": "string",
          "description": "Date and time the video was saved.",
          "format": "date-time"
        },
        "isFavorite": {
          "type": "boolean",
          "description": "Indicates if the video is marked as a favorite."
        }
      },
      "required": [
        "id",
        "userId",
        "title",
        "url",
        "platform",
        "duration",
        "thumbnailUrl",
        "categoryId",
        "savedAt"
      ]
    },
    "Category": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Category",
      "type": "object",
      "description": "Represents a category for organizing videos.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the category.",
          "format": "uuid"
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User who created the category. (Relationship: User 1:N Category)"
        },
        "name": {
          "type": "string",
          "description": "Name of the category."
        },
        "emoji": {
          "type": "string",
          "description": "Emoji associated with the category."
        },
        "color": {
          "type": "string",
          "description": "Color associated with the category (e.g., hex code)."
        }
      },
      "required": [
        "id",
        "userId",
        "name",
        "emoji",
        "color"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user.",
          "format": "uuid"
        },
        "username": {
          "type": "string",
          "description": "Username of the user."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "profileImageUrl": {
          "type": "string",
          "description": "URL of the user's profile image.",
          "format": "uri"
        }
      },
      "required": [
        "id",
        "username",
        "email"
      ]
    }
  },
  "auth": {
    "providers": [
      "password"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. User documents are created and managed by Firebase Authentication.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user, corresponding to their Firebase Auth UID."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/videos/{videoId}",
        "definition": {
          "entityName": "Video",
          "schema": {
            "$ref": "#/backend/entities/Video"
          },
          "description": "Stores videos saved by the user. Path-based ownership ensures only the user can access these videos.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user, corresponding to their Firebase Auth UID."
            },
            {
              "name": "videoId",
              "description": "The unique identifier for the video."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/categories/{categoryId}",
        "definition": {
          "entityName": "Category",
          "schema": {
            "$ref": "#/backend/entities/Category"
          },
          "description": "Stores categories created by the user for organizing videos. Path-based ownership ensures only the user can access these categories.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user, corresponding to their Firebase Auth UID."
            },
            {
              "name": "categoryId",
              "description": "The unique identifier for the category."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to ensure authorization independence, clarity, and scalability for the VideoKoleks application. It follows the principle of segregating user-owned data into hierarchical paths for robust security and efficient data access. The structure avoids relying on `get()` calls in security rules by denormalizing data and utilizes path-based ownership for user-specific collections, ensuring atomic operations and easier debugging.\n\nAuthorization Independence is achieved by structuring data in a way that access control can be determined independently at each level without needing to fetch parent documents. For instance, videos are stored under the user's ID, allowing direct access checks based on the `request.auth.uid`.\n\nThe QAPs are supported as follows:\n\n*   **Secure List Operations:** By storing each user's data under their own path (`/users/{userId}/videos/{videoId}`), listing videos becomes inherently secure. Security rules can easily verify if the requesting user ID matches the owner (`request.auth.uid == userId`). The same applies to categories.\n*   **Data Segregation:** Public and private data are naturally segregated as all data is user-owned. The structure doesn't require mixing data with varying access needs within a single collection.\n*   **No Custom Claims (DBAC):** Roles are managed through the Firebase Authentication and are accessible via `request.auth.uid`.\n\nBy adhering to these principles, the structure simplifies security rules, enhances debuggability, and ensures the application can scale effectively."
  }
}
